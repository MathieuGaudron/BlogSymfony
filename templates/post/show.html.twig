{% extends 'base.html.twig' %}

{% block title %}{{ post.title }}{% endblock %}

{% block body %}
<div class="auth-bg">
  <div class="admin-wrap home-wrap">

    <a class="admin-link" href="{{ path('app_home') }}">← Retour</a>

    <article class="post-card" style="margin-top: 12px;">
      <div class="post-head">
        <h1 class="post-title">{{ post.title }}</h1>
        <div class="post-meta">
          <span>{{ post.publishedAt|date('d/m/Y H:i') }}</span>
          <span>•</span>
          <span>{{ post.author.firstName ?? 'Auteur' }}</span>
          <span>•</span>
          <span>{{ post.category.name ?? 'Catégorie' }}</span>
        </div>
      </div>

      {% if post.picture %}
        <img class="post-img" src="{{ asset('uploads/posts/' ~ post.picture) }}" alt="">
      {% endif %}

      <p class="post-content">{{ post.content }}</p>

      <div class="comments">
        <h3 class="comments-title">Commentaires</h3>

        {% for comment in post.comments %}
          <div class="comment">
            <div class="comment-meta">
              <strong>{{ comment.author.firstName ?? 'Anonyme' }}</strong>
              <span>•</span>
              <span>{{ comment.createdAt|date('d/m/Y H:i') }}</span>
            </div>
            <div class="comment-text">{{ comment.content }}</div>
          </div>
        {% else %}
          <p class="admin-empty">Aucun commentaire.</p>
        {% endfor %}

        {% if app.user %}
          <form class="comment-form" method="post" action="{{ path('post_add_comment', {id: post.id}) }}">
            <input type="hidden" name="_token" value="{{ csrf_token('add_comment_' ~ post.id) }}">

            <textarea class="admin-control admin-control--textarea comment-textarea"
                      name="content"
                      placeholder="Écris un commentaire..."
                      required></textarea>

            <div class="comment-actions">
              <button class="btn-auth admin-submit" type="submit">Commenter</button>
            </div>
          </form>
        {% else %}
          <p class="admin-empty">
            <a class="admin-link" href="{{ path('app_login') }}">Connecte-toi</a> pour commenter.
          </p>
        {% endif %}
      </div>

    </article>

  </div>
</div>
{% endblock %}